<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Express Exchange - Réseau Social Étudiant</title>
  <style>
    /* --- Ton CSS habituel (voir messages précédents) --- */
    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      min-height: 100vh;
      color: #222;
      overflow-x: hidden;
    }
    .video-background {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; overflow: hidden;
    }
    .video-background video {
      width: 100%; height: 100%; object-fit: cover; opacity: 0.7;
    }
    .video-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.6) 0%, rgba(118, 75, 162, 0.6) 100%);
      z-index: -1;
    }
    .particles {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: -1;
    }
    .particle {
      position: absolute; width: 4px; height: 4px; background: rgba(255,255,255,0.6);
      border-radius: 50%; animation: float 6s infinite ease-in-out;
    }
    @keyframes float {
      0%,100% { transform: translateY(0) rotate(0deg); opacity: 0; }
      50% { transform: translateY(-100px) rotate(180deg); opacity: 1; }
    }
    .registration-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 1000;
      backdrop-filter: blur(10px);
    }
    .registration-form {
      background: rgba(255,255,255,0.95); padding: 40px; border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3); max-width: 400px; width: 90%;
      text-align: center; backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .registration-form h2 { color: #764ba2; margin-bottom: 10px; font-size: 1.8em; }
    .registration-form p { color: #666; margin-bottom: 30px; }
    .form-group { margin-bottom: 20px; text-align: left; }
    .form-group label { display: block; margin-bottom: 5px; color: #333; font-weight: 600; }
    .form-group input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px;
      font-size: 16px; transition: border-color 0.3s; background: rgba(255,255,255,0.9); }
    .form-group input:focus { outline: none; border-color: #667eea; background: rgba(255,255,255,1);}
    .submit-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea, #764ba2);
      color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold;
      cursor: pointer; transition: transform 0.3s;}
    .submit-btn:hover { transform: translateY(-2px);}
    .main-app { display: none; }
    .container { max-width: 600px; margin: 0 auto; padding: 20px;}
    .header { text-align: center; color: #fff; margin-bottom: 30px;
      text-shadow: 0 2px 12px rgba(0,0,0,0.3);}
    .header h1 { font-size: 2.5em; margin-bottom: 10px; letter-spacing: 0.03em;}
    .user-info { background: rgba(255,255,255,0.15); padding: 10px 20px; border-radius: 25px;
      margin-bottom: 20px; text-align: center; color: white; backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);}
    .status-indicator { display: inline-block; padding: 5px 15px; border-radius: 15px; font-size: 14px; margin-left: 10px;}
    .status-connected { background: rgba(34,197,94,0.2); color: #22c55e;}
    .status-disconnected { background: rgba(239,68,68,0.2); color: #ef4444;}
    .post-form { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px;
      margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);}
    .post-textarea { width: 100%; min-height: 100px; padding: 15px; border: 2px solid #eee; border-radius: 10px;
      font-size: 16px; resize: vertical; font-family: inherit; background: rgba(255,255,255,0.9);}
    .post-textarea:focus {outline:none; border-color:#667eea; background:rgba(255,255,255,1);}
    .file-input-wrapper { margin: 15px 0;}
    .file-input { display: none;}
    .file-input-label { display: inline-block; padding: 10px 20px; background: rgba(240,240,240,0.9);
      border-radius: 25px; cursor: pointer; transition: background 0.3s;}
    .file-input-label:hover {background:rgba(224,224,224,0.9);}
    .post-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 15px;}
    .post-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none;
      padding: 12px 30px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer;
      transition: transform 0.3s;}
    .post-btn:hover { transform: translateY(-2px);}
    .post-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none;}
    .feed { display: flex; flex-direction: column; gap: 20px;}
    .publication { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1); animation: fadeIn 0.5s; backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);}
    @keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);}}
    .pub-header { display: flex; align-items: center; margin-bottom: 15px;}
    .pub-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px; margin-right: 10px;}
    .pub-info { flex: 1;}
    .pub-username { font-weight: bold; color: #333; margin-bottom: 2px;}
    .pub-time { color: #666; font-size: 14px;}
    .pub-text { margin-bottom: 15px; line-height: 1.6; white-space: pre-wrap;}
    .image-link { cursor: pointer; display: inline-block; max-width: 100%;}
    .image-link img { max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 1px 8px rgba(0,0,0,0.09); transition: transform 0.2s;}
    .image-link img:hover { transform: scale(1.04);}
    .modal-image-view { display: none; position: fixed; top:0; left:0; width:100vw; height:100vh; background: rgba(0,0,0,0.92); z-index: 4000; justify-content: center; align-items: center;}
    .modal-image-view img { max-width: 98vw; max-height: 96vh; border-radius: 12px; box-shadow: 0 2px 32px #0008;}
    .close-modal-image { position: absolute; top: 24px; right: 40px; color: #fff; font-size: 40px; cursor:pointer; z-index: 4050;}
    .pub-actions { display: flex; gap: 20px; margin-bottom: 15px; padding: 10px 0; border-top: 1px solid #eee;}
    .action-btn { background: none; border: none; color: #666; cursor: pointer; font-size: 16px; display: flex; align-items: center; gap: 8px; transition: color 0.3s;}
    .action-btn:hover { color: #667eea;}
    .action-btn.liked { color: #e74c3c;}
    .comments-section { border-top:1px solid #eee; padding-top:15px;}
    .comment { background: rgba(248,249,250,0.8); padding: 10px 15px; border-radius: 10px; margin-bottom: 10px;}
    .comment-header { display: flex; align-items: center; margin-bottom: 8px;}
    .comment-avatar { width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px; margin-right: 8px;}
    .comment-username { font-weight: bold; color: #333; font-size: 14px;}
    .comment-time { color: #666; font-size: 12px; margin-left: auto;}
    .comment-text { font-size: 14px; line-height: 1.4;}
    .comment-form { display: flex; gap: 10px; margin-top: 10px;}
    .comment-input { flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 20px; font-size: 14px; background: rgba(255,255,255,0.9);}
    .comment-input:focus { outline: none; border-color: #667eea; background: rgba(255,255,255,1);}
    .comment-btn { background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 14px;}
    .comment-btn:hover { background: #5a67d8;}
    @media (max-width: 768px) {
      .container { padding: 10px;}
      .header h1 { font-size: 2em;}
      .registration-form { padding: 30px 20px;}
      .modal-image-view img { max-width:95vw; max-height:95vh;}
    }
  </style>
 <style>
    body { font-family: 'Segoe UI',sans-serif; background: #f0f2f5; color: #222; margin:0; }
    .video-background { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:-2; overflow:hidden;}
    .video-background video { width:100vw; height:100vh; object-fit:cover; opacity:0.7; }
    .video-overlay { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:-1;
      background:linear-gradient(135deg,rgba(102,126,234,0.6) 0%,rgba(118,75,162,0.6) 100%);}
    .particles { position:fixed; top:0; left:0; width:100vw; height:100vh; pointer-events:none; z-index:0;}
    .particle { position:absolute; width:4px; height:4px; background:rgba(255,255,255,0.6); border-radius:50%; animation:float 6s infinite ease-in-out;}
    @keyframes float { 0%,100% {transform:translateY(0) rotate(0); opacity:0;} 50%{transform:translateY(-100px) rotate(180deg); opacity:1;} }
    .registration-overlay { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:1000; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,0.8);}
    .registration-form { background:rgba(255,255,255,0.97); border-radius:15px; padding:40px; box-shadow:0 8px 40px #0003; min-width:320px; max-width:95vw;}
    .registration-form h2 { color:#764ba2; margin-bottom:10px; }
    .form-group { margin-bottom:18px; }
    .form-group label { font-weight:600; display:block; margin-bottom:5px;}
    .form-group input { width:100%; padding:10px; border-radius:7px; border:2px solid #ddd; font-size:15px;}
    .form-group input:focus { outline:none; border-color:#667eea;}
    .submit-btn { width:100%; padding:12px; border-radius:8px; border:none; background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; font-weight:bold; font-size:16px;}
    .submit-btn:hover { filter:brightness(1.1);}
    .main-app { display:none;}
    .container { max-width:580px; margin:0 auto; background:none; padding:18px;}
    .header { text-align:center; color:#fff; margin-bottom:18px; text-shadow:0 2px 10px #0003;}
    .header h1 { font-size:2.2em; margin-bottom:8px;}
    .user-info { background:rgba(255,255,255,0.13); padding:7px 18px; border-radius:20px; color:#fff; margin-bottom:20px; display:inline-block;}
    .status-indicator { margin-left:10px; border-radius:12px; padding:2px 12px; font-size:13px;}
    .status-connected { background:rgba(34,197,94,0.15); color:#22c55e;}
    .status-disconnected { background:rgba(239,68,68,0.16); color:#ef4444;}
    .post-form { background:rgba(255,255,255,0.99); border-radius:13px; padding:18px; margin-bottom:18px; box-shadow:0 3px 14px #0001;}
    .post-textarea { width:100%; min-height:70px; padding:11px; border:2px solid #eee; border-radius:8px; font-size:15px; background:#fcfcfe;}
    .post-textarea:focus { outline:none; border-color:#667eea;}
    .file-input-wrapper { margin:11px 0;}
    .file-input { display:none;}
    .file-input-label { display:inline-block; padding:7px 20px; background:#f0f0f7; border-radius:20px; cursor:pointer; }
    .file-input-label:hover { background:#e5e5ef; }
    .post-actions { display:flex; justify-content:space-between; align-items:center; margin-top:10px;}
    .post-btn { background:linear-gradient(135deg, #667eea, #764ba2); color:#fff; border:none; padding:9px 20px; border-radius:18px; font-size:15px; font-weight:500;}
    .post-btn:disabled { opacity:0.5; cursor:not-allowed;}
    .feed { display:flex; flex-direction:column; gap:16px;}
    .publication { background:#fff; border-radius:13px; padding:17px; box-shadow:0 2px 12px #0001;}
    .pub-header { display:flex; align-items:center; margin-bottom:10px;}
    .pub-avatar { width:36px; height:36px; border-radius:50%; background:linear-gradient(135deg,#667eea,#764ba2); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:600; font-size:16px; margin-right:9px;}
    .pub-info { flex:1;}
    .pub-username { font-weight:bold; color:#333;}
    .pub-time { color:#666; font-size:13px;}
    .pub-text { margin-bottom:11px; white-space:pre-wrap; }
    .image-link { cursor:pointer; display:inline-block; max-width:100%; margin-bottom:12px;}
    .image-link img { max-width:100%; max-height:270px; border-radius:7px; box-shadow:0 1px 6px #0002; transition:transform 0.18s;}
    .image-link img:hover { transform:scale(1.04);}
    .modal-image-view { display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.90); z-index:4000; justify-content:center; align-items:center;}
    .modal-image-view img { max-width:98vw; max-height:96vh; border-radius:12px; box-shadow:0 2px 32px #0008;}
    .close-modal-image { position:absolute; top:24px; right:40px; color:#fff; font-size:40px; cursor:pointer; z-index:4050;}
    .pub-actions { display:flex; gap:16px; margin-bottom:11px; padding:7px 0; border-top:1px solid #eee;}
    .action-btn { background:none; border:none; color:#666; cursor:pointer; font-size:15px; display:flex; align-items:center; gap:6px;}
    .action-btn:hover { color:#667eea;}
    .action-btn.liked { color:#e74c3c;}
    .comments-section { border-top:1px solid #eee; padding-top:10px;}
    .comment { background:#f7f7fb; padding:8px 14px; border-radius:8px; margin-bottom:7px;}
    .comment-header { display:flex; align-items:center; margin-bottom:4px;}
    .comment-avatar { width:26px; height:26px; border-radius:50%; background:linear-gradient(135deg, #667eea, #764ba2); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; font-size:12px; margin-right:8px;}
    .comment-username { font-weight:bold; color:#333; font-size:13px;}
    .comment-time { color:#666; font-size:11px; margin-left:auto;}
    .comment-text { font-size:13px;}
    .comment-form { display:flex; gap:8px; margin-top:7px;}
    .comment-input { flex:1; padding:7px 12px; border:1px solid #ddd; border-radius:17px; font-size:13px; background:#fff;}
    .comment-input:focus { outline:none; border-color:#667eea;}
    .comment-btn { background:#667eea; color:#fff; border:none; padding:6px 13px; border-radius:16px; font-size:13px;}
    .comment-btn:hover { background:#5a67d8;}
    @media (max-width:680px) { .container{padding:4px;} .header h1{font-size:1.4em;} .registration-form{padding:18px 4px;} }
  </style>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Express Exchange - Réseau Social Étudiant</title>
  <style>
    body { font-family: 'Segoe UI',sans-serif; background: #f0f2f5; color: #222; margin:0; }
    .video-background { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:-2; overflow:hidden;}
    .video-background video { width:100vw; height:100vh; object-fit:cover; opacity:0.7; }
    .video-overlay { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:-1;
      background:linear-gradient(135deg,rgba(102,126,234,0.6) 0%,rgba(118,75,162,0.6) 100%);}
    .particles { position:fixed; top:0; left:0; width:100vw; height:100vh; pointer-events:none; z-index:0;}
    .particle { position:absolute; width:4px; height:4px; background:rgba(255,255,255,0.6); border-radius:50%; animation:float 6s infinite ease-in-out;}
    @keyframes float { 0%,100% {transform:translateY(0) rotate(0); opacity:0;} 50%{transform:translateY(-100px) rotate(180deg); opacity:1;} }
    .registration-overlay { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:1000; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,0.8);}
    .registration-form { background:rgba(255,255,255,0.97); border-radius:15px; padding:40px; box-shadow:0 8px 40px #0003; min-width:320px; max-width:95vw;}
    .registration-form h2 { color:#764ba2; margin-bottom:10px; }
    .form-group { margin-bottom:18px; }
    .form-group label { font-weight:600; display:block; margin-bottom:5px;}
    .form-group input { width:100%; padding:10px; border-radius:7px; border:2px solid #ddd; font-size:15px;}
    .form-group input:focus { outline:none; border-color:#667eea;}
    .submit-btn { width:100%; padding:12px; border-radius:8px; border:none; background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; font-weight:bold; font-size:16px;}
    .submit-btn:hover { filter:brightness(1.1);}
    .main-app { display:none;}
    .container { max-width:580px; margin:0 auto; background:none; padding:18px;}
    .header { text-align:center; color:#fff; margin-bottom:18px; text-shadow:0 2px 10px #0003;}
    .header h1 { font-size:2.2em; margin-bottom:8px;}
    .user-info { background:rgba(255,255,255,0.13); padding:7px 18px; border-radius:20px; color:#fff; margin-bottom:20px; display:inline-block;}
    .status-indicator { margin-left:10px; border-radius:12px; padding:2px 12px; font-size:13px;}
    .status-connected { background:rgba(34,197,94,0.15); color:#22c55e;}
    .status-disconnected { background:rgba(239,68,68,0.16); color:#ef4444;}
    .post-form { background:rgba(255,255,255,0.99); border-radius:13px; padding:18px; margin-bottom:18px; box-shadow:0 3px 14px #0001;}
    .post-textarea { width:100%; min-height:70px; padding:11px; border:2px solid #eee; border-radius:8px; font-size:15px; background:#fcfcfe;}
    .post-textarea:focus { outline:none; border-color:#667eea;}
    .file-input-wrapper { margin:11px 0;}
    .file-input { display:none;}
    .file-input-label { display:inline-block; padding:7px 20px; background:#f0f0f7; border-radius:20px; cursor:pointer; }
    .file-input-label:hover { background:#e5e5ef; }
    .post-actions { display:flex; justify-content:space-between; align-items:center; margin-top:10px;}
    .post-btn { background:linear-gradient(135deg, #667eea, #764ba2); color:#fff; border:none; padding:9px 20px; border-radius:18px; font-size:15px; font-weight:500;}
    .post-btn:disabled { opacity:0.5; cursor:not-allowed;}
    .feed { display:flex; flex-direction:column; gap:16px;}
    .publication { background:#fff; border-radius:13px; padding:17px; box-shadow:0 2px 12px #0001;}
    .pub-header { display:flex; align-items:center; margin-bottom:10px;}
    .pub-avatar { width:36px; height:36px; border-radius:50%; background:linear-gradient(135deg,#667eea,#764ba2); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:600; font-size:16px; margin-right:9px;}
    .pub-info { flex:1;}
    .pub-username { font-weight:bold; color:#333;}
    .pub-time { color:#666; font-size:13px;}
    .pub-text { margin-bottom:11px; white-space:pre-wrap; }
    .image-link { cursor:pointer; display:inline-block; max-width:100%; margin-bottom:12px;}
    .image-link img { max-width:100%; max-height:270px; border-radius:7px; box-shadow:0 1px 6px #0002; transition:transform 0.18s;}
    .image-link img:hover { transform:scale(1.04);}
    .modal-image-view { display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.90); z-index:4000; justify-content:center; align-items:center;}
    .modal-image-view img { max-width:98vw; max-height:96vh; border-radius:12px; box-shadow:0 2px 32px #0008;}
    .close-modal-image { position:absolute; top:24px; right:40px; color:#fff; font-size:40px; cursor:pointer; z-index:4050;}
    .pub-actions { display:flex; gap:16px; margin-bottom:11px; padding:7px 0; border-top:1px solid #eee;}
    .action-btn { background:none; border:none; color:#666; cursor:pointer; font-size:15px; display:flex; align-items:center; gap:6px;}
    .action-btn:hover { color:#667eea;}
    .action-btn.liked { color:#e74c3c;}
    .comments-section { border-top:1px solid #eee; padding-top:10px;}
    .comment { background:#f7f7fb; padding:8px 14px; border-radius:8px; margin-bottom:7px;}
    .comment-header { display:flex; align-items:center; margin-bottom:4px;}
    .comment-avatar { width:26px; height:26px; border-radius:50%; background:linear-gradient(135deg, #667eea, #764ba2); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; font-size:12px; margin-right:8px;}
    .comment-username { font-weight:bold; color:#333; font-size:13px;}
    .comment-time { color:#666; font-size:11px; margin-left:auto;}
    .comment-text { font-size:13px;}
    .comment-form { display:flex; gap:8px; margin-top:7px;}
    .comment-input { flex:1; padding:7px 12px; border:1px solid #ddd; border-radius:17px; font-size:13px; background:#fff;}
    .comment-input:focus { outline:none; border-color:#667eea;}
    .comment-btn { background:#667eea; color:#fff; border:none; padding:6px 13px; border-radius:16px; font-size:13px;}
    .comment-btn:hover { background:#5a67d8;}
    @media (max-width:680px) { .container{padding:4px;} .header h1{font-size:1.4em;} .registration-form{padding:18px 4px;} }
  </style>
</head>
<body>
<div style="text-align: right; margin-bottom: 14px;">
  <button id="showMyPostsBtn" class="post-btn" style="padding: 8px 22px; font-size:15px;">🗂️ Mes publications</button>
</div>

<!-- Modal pour afficher la liste des publications de l'utilisateur -->
<div id="myPostsModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:2000; background:rgba(0,0,0,0.85); justify-content:center; align-items:center;">
  <div style="background:#fff; border-radius:18px; max-width:500px; width:95vw; max-height:85vh; overflow:auto; box-shadow:0 10px 40px #0005; padding:24px 18px 18px 18px; position:relative;">
    <span id="closeMyPostsModal" style="position:absolute; top:14px; right:28px; color:#764ba2; font-size:32px; cursor:pointer;">&times;</span>
    <h3 style="margin-top:0; margin-bottom:18px; color:#764ba2;">Mes publications</h3>
    <div id="myPostsList"></div>
  </div>
</div>

  <div class="video-background">
    <video autoplay muted loop>
      <source src="https://videos.pexels.com/video-files/5212456/5212456-hd_1920_1080_30fps.mp4" type="video/mp4">
      Votre navigateur ne supporte pas la vidéo HTML5.
    </video>
  </div>
  <div class="video-overlay"></div>
  <div class="particles" id="particles"></div>
  <!-- Modal image agrandie -->
  <div class="modal-image-view" id="modalImageView">
    <span class="close-modal-image" onclick="closeImageModal()">&times;</span>
    <img id="modalImageBig" src="" alt="Image publication">
  </div>
  <!-- Formulaire d'inscription -->
  <div class="registration-overlay" id="registrationOverlay">
    <div class="registration-form">
      <h2>🎓 Express Exchange</h2>
      <p>Rejoignez le réseau social étudiant</p>
      <form id="registrationForm">
        <div class="form-group">
          <label for="nom">Nom *</label>
          <input type="text" id="nom" name="nom" required>
        </div>
        <div class="form-group">
          <label for="prenom">Prénom *</label>
          <input type="text" id="prenom" name="prenom" required>
        </div>
        <div class="form-group">
          <label for="contact">Contact (Email ou Téléphone) *</label>
          <input type="text" id="contact" name="contact" required>
        </div>
        <button type="submit" class="submit-btn">Rejoindre Express Exchange</button>
      </form>
    </div>
  </div>
  <!-- Interface principale -->
  <div class="main-app" id="mainApp">
    <div class="container">
      <div class="header">
        <h1>📱 Express Exchange</h1>
        <div class="user-info" id="userInfo">
          <span id="welcomeMessage"></span>
          <span class="status-indicator" id="statusIndicator">🔄 Connexion...</span>
        </div>
      </div>
      <div class="post-form">
        <textarea class="post-textarea" id="postText" placeholder="Que voulez-vous partager ?"></textarea>
        <div class="file-input-wrapper">
          <input type="file" id="fileInput" class="file-input" accept="image/*">
          <label for="fileInput" class="file-input-label">
            📷 Ajouter une photo
          </label>
          <span id="fileName"></span>
        </div>
        <div class="post-actions">
          <div id="mediaPreview"></div>
          <button class="post-btn" id="publishBtn">Publier</button>
        </div>
      </div>
      <div class="feed" id="feed"></div>
    </div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
  <script>
  // --- CONFIG FIREBASE ---
  const firebaseConfig = {
    apiKey: "AIzaSyCPGgtXoDUycykLaTSee0S0yY0tkeJpqKI",
    authDomain: "data-com-a94a8.firebaseapp.com",
    databaseURL: "https://data-com-a94a8-default-rtdb.firebaseio.com",
    projectId: "data-com-a94a8",
    storageBucket: "data-com-a94a8.appspot.com",
    messagingSenderId: "276904640935",
    appId: "1:276904640935:web:9cd805aeba6c34c767f682",
    measurementId: "G-FYQCWY5G4S"
  };
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  let userData = null;
  let posts = [];
  let postsListener = null;
  let isConnected = false;
  let compressedImageDataUrl = null; // Stockage de l'image compressée

  // --- UTILITAIRES ---
  function removeUndefinedDeep(obj) {
    if (Array.isArray(obj)) {
      return obj.map(removeUndefinedDeep);
    } else if (obj && typeof obj === 'object') {
      const cleaned = {};
      for (const key in obj) {
        if (obj[key] !== undefined) {
          cleaned[key] = removeUndefinedDeep(obj[key]);
        }
      }
      return cleaned;
    }
    return obj;
  }

  function updateConnectionStatus() {
    const statusIndicator = document.getElementById('statusIndicator');
    if (statusIndicator) {
      statusIndicator.textContent = isConnected ? '🟢 Connecté' : '🔴 Hors ligne';
      statusIndicator.className = isConnected ? 'status-indicator status-connected' : 'status-indicator status-disconnected';
    }
  }
  database.ref(".info/connected").on("value", (snap) => {
    isConnected = snap.val() === true;
    updateConnectionStatus();
  });

  function checkUserRegistration() {
    const stored = localStorage.getItem('expressExchangeUser');
    if (stored) {
      userData = JSON.parse(stored);
      showMainApp();
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    createParticles();
    checkUserRegistration();
    setInterval(() => {
      if (document.getElementById('mainApp').style.display !== 'none') renderPosts();
    }, 60000);
  });

  // --- COMPRESSION AVEC BARRE ---
  function compressImage(file, maxSizeKo = 600, callback) {
    const progressBar = document.getElementById('compressionProgress');
    progressBar.style.width = '0%';
    progressBar.parentElement.style.display = 'block';

    const reader = new FileReader();
    reader.onload = function(event) {
      const img = new Image();
      img.onload = function() {
        let width = img.width, height = img.height, maxPixels = 1024;
        if (width > maxPixels || height > maxPixels) {
          if (width > height) {
            height = Math.round(height * maxPixels / width);
            width = maxPixels;
          } else {
            width = Math.round(width * maxPixels / height);
            height = maxPixels;
          }
        }
        const canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);

        let quality = 0.85;
        let dataUrl = canvas.toDataURL('image/webp', quality);
        let iteration = 0;

        function stepCompression() {
          const currentSize = dataUrl.length / 1024;
          const percent = Math.min(100, Math.round((iteration / 10) * 100));
          progressBar.style.width = percent + '%';

          if (currentSize > maxSizeKo && quality > 0.4) {
            quality -= 0.05;
            dataUrl = canvas.toDataURL('image/webp', quality);
            iteration++;
            setTimeout(stepCompression, 50);
          } else {
            progressBar.style.width = '100%';
            setTimeout(() => progressBar.parentElement.style.display = 'none', 500);
            callback(dataUrl);
          }
        }
        stepCompression();
      };
      img.src = event.target.result;
    };
    reader.readAsDataURL(file);
  }

  document.getElementById('registrationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const nom = document.getElementById('nom').value.trim();
    const prenom = document.getElementById('prenom').value.trim();
    const contact = document.getElementById('contact').value.trim();
    if (nom && prenom && contact) {
      userData = {
        id: Date.now().toString(),
        nom: nom,
        prenom: prenom,
        contact: contact,
        fullName: `${prenom} ${nom}`,
        avatar: `${prenom[0]}${nom[0]}`.toUpperCase(),
        registeredAt: new Date().toISOString()
      };
      localStorage.setItem('expressExchangeUser', JSON.stringify(userData));
      if (isConnected) database.ref('users/' + userData.id).set(userData);
      showMainApp();
    }
  });

  function showMainApp() {
    document.getElementById('registrationOverlay').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    document.getElementById('welcomeMessage').textContent = `Bienvenue ${userData.fullName} 👋`;
    updateConnectionStatus();
    loadPosts();
  }

  function loadPosts() {
    if (postsListener) postsListener.off();
    postsListener = database.ref('posts').orderByChild('timestamp');
    postsListener.on('value', (snapshot) => {
      posts = [];
      snapshot.forEach((childSnapshot) => {
        const post = childSnapshot.val();
        posts.unshift(post);
      });
      renderPosts();
    });
  }

  document.getElementById('publishBtn').addEventListener('click', function() {
    const text = document.getElementById('postText').value.trim();
    if (!text && !compressedImageDataUrl) {
      alert('Veuillez ajouter du texte ou une image');
      return;
    }
    const publishBtn = document.getElementById('publishBtn');
    publishBtn.disabled = true;
    publishBtn.textContent = 'Publication...';

    const postId = Date.now().toString();
    let post = {
      id: postId,
      author: userData.fullName,
      authorId: userData.id,
      avatar: `${userData.avatar}`,
      text: text,
      imageUrl: compressedImageDataUrl || null,
      timestamp: new Date().toISOString()
    };

    database.ref('posts/' + post.id).set(removeUndefinedDeep(post))
      .then(() => { clearPostForm(); resetPublishButton(); })
      .catch(() => { alert('Erreur lors de la publication.'); resetPublishButton(); });
  });

  function resetPublishButton() {
    const publishBtn = document.getElementById('publishBtn');
    publishBtn.disabled = false;
    publishBtn.textContent = 'Publier';
  }

  document.getElementById('fileInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const fileName = document.getElementById('fileName');
    const preview = document.getElementById('mediaPreview');
    if (file) {
      fileName.textContent = file.name;
      compressImage(file, 600, function(dataUrl) {
        compressedImageDataUrl = dataUrl;
        preview.innerHTML = `<img src="${dataUrl}" style="max-width: 100px; max-height: 100px; border-radius: 5px;">`;
      });
    } else {
      compressedImageDataUrl = null;
      fileName.textContent = '';
      preview.innerHTML = '';
    }
  });

  function clearPostForm() {
    document.getElementById('postText').value = '';
    document.getElementById('fileInput').value = '';
    document.getElementById('fileName').textContent = '';
    document.getElementById('mediaPreview').innerHTML = '';
    compressedImageDataUrl = null;
  }

  // --- IMAGE MODAL ---
  window.openImageModal = function(imgUrl) {
    const modal = document.getElementById('modalImageView');
    const modalImg = document.getElementById('modalImageBig');
    modal.style.display = 'flex';
    modalImg.src = imgUrl;
  };
  window.closeImageModal = function() {
    document.getElementById('modalImageView').style.display = 'none';
  };
  document.getElementById('modalImageView').addEventListener('click', function(e){
    if(e.target === this){ closeImageModal(); }
  });
  document.addEventListener('keydown', function(e){
    if(e.key === 'Escape'){ closeImageModal(); }
  });

  // --- Likes & Comments ---
  function listenLikesAndComments(postId) {
    database.ref('likes/' + postId).on('value', snap => {
      const likes = snap.val() || {};
      const cleanedLikes = removeUndefinedDeep(likes);
      const post = posts.find(p => p.id === postId);
      if (post) {
        post.likes = cleanedLikes;
        renderPosts();
      }
    });
    database.ref('comments/' + postId).on('value', snap => {
      const comments = snap.val() || {};
      const cleanedComments = removeUndefinedDeep(comments);
      const post = posts.find(p => p.id === postId);
      if (post) {
        post.comments = cleanedComments;
        renderPosts();
      }
    });
  }

  function renderPosts() {
    const feed = document.getElementById('feed');
    feed.innerHTML = '';
    posts.forEach(post => {
      if (!post._listeners) {
        listenLikesAndComments(post.id);
        post._listeners = true;
      }
      const likesCount = post.likes ? Object.keys(post.likes).length : 0;
      const commentsCount = post.comments ? Object.keys(post.comments).length : 0;
      const isLiked = post.likes && post.likes[userData.id];
      const timeAgo = getTimeAgo(post.timestamp);
      let imageHTML = '';
      if (post.imageUrl) {
        imageHTML = `
          <div>
            <a class="image-link" onclick="openImageModal('${post.imageUrl}')">
              <img src="${post.imageUrl}" alt="Image publication">
            </a>
          </div>
        `;
      }
      let commentsHTML = '';
      if (post.comments) {
        const commentsList = Object.values(post.comments).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
        commentsHTML = commentsList.map(comment => `
          <div class="comment">
            <div class="comment-header">
              <div class="comment-avatar">${comment.avatar}</div>
              <div class="comment-username">${comment.author}</div>
              <div class="comment-time">${getTimeAgo(comment.timestamp)}</div>
            </div>
            <div class="comment-text">${comment.text}</div>
          </div>
        `).join('');
      }
      const postHtml = `
        <div class="publication">
          <div class="pub-header">
            <div class="pub-avatar">${post.avatar}</div>
            <div class="pub-info">
              <div class="pub-username">${post.author}</div>
              <div class="pub-time">${timeAgo}</div>
            </div>
          </div>
          <div class="pub-text">${post.text}</div>
          ${imageHTML}
          <div class="pub-actions">
            <button class="action-btn ${isLiked ? 'liked' : ''}" onclick="toggleLike('${post.id}')" id="like-btn-${post.id}">
              ${isLiked ? '❤️' : '🤍'} ${likesCount}
            </button>
            <button class="action-btn" onclick="toggleComments('${post.id}')">
              💬 ${commentsCount}
            </button>
          </div>
          <div class="comments-section" id="comments-${post.id}" style="display: none;">
            ${commentsHTML}
            <div class="comment-form">
              <input type="text" class="comment-input" placeholder="Écrivez un commentaire..." id="comment-input-${post.id}">
              <button class="comment-btn" onclick="submitComment('${post.id}')">Envoyer</button>
            </div>
          </div>
        </div>
      `;
      feed.innerHTML += postHtml;
    });
  }

  window.toggleLike = function(postId) {
    const btn = document.getElementById('like-btn-' + postId);
    if (btn) btn.disabled = true;
    const likeRef = database.ref('likes/' + postId + '/' + userData.id);
    likeRef.once('value').then(snapshot => {
      if (snapshot.exists()) {
        likeRef.remove();
      } else {
        likeRef.set(removeUndefinedDeep({
          userId: userData.id,
          username: userData.fullName,
          timestamp: new Date().toISOString()
        }));
      }
      if (btn) btn.disabled = false;
    });
  };

  window.toggleComments = function(postId) {
    const commentsSection = document.getElementById(`comments-${postId}`);
    commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
  };

  window.submitComment = function(postId) {
    const input = document.getElementById(`comment-input-${postId}`);
    const commentText = input.value.trim();
    if (!commentText) return;
    const commentsRef = database.ref('comments/' + postId);
    const commentId = commentsRef.push().key;
    const comment = removeUndefinedDeep({
      id: commentId,
      author: userData.fullName,
      authorId: userData.id,
      avatar: userData.avatar,
      text: commentText,
      timestamp: new Date().toISOString()
    });
    commentsRef.child(commentId).set(comment);
    input.value = '';
  };

  document.addEventListener('keydown', function(e) {
    if (e.target.classList.contains('comment-input') && e.key === 'Enter') {
      const postId = e.target.id.replace('comment-input-', '');
      window.submitComment(postId);
    }
  });

  function getTimeAgo(timestamp) {
    const now = new Date();
    const time = new Date(timestamp);
    const diffInSeconds = Math.floor((now - time) / 1000);
    if (diffInSeconds < 60) return 'À l\'instant';
    if (diffInSeconds < 3600) {
      const minutes = Math.floor(diffInSeconds / 60);
      return `Il y a ${minutes} minute${minutes > 1 ? 's' : ''}`;
    } else if (diffInSeconds < 86400) {
      const hours = Math.floor(diffInSeconds / 3600);
      return `Il y a ${hours} heure${hours > 1 ? 's' : ''}`;
    } else {
      const days = Math.floor(diffInSeconds / 86400);
      return `Il y a ${days} jour${days > 1 ? 's' : ''}`;
    }
  }

  function createParticles() {
    const particles = document.getElementById('particles');
    if (!particles) return;
    for (let i = 0; i < 20; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 6 + 's';
      particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
      particles.appendChild(particle);
    }
  }
  window.addEventListener('resize', function() {
    const particles = document.getElementById('particles');
    if (particles) {
      particles.innerHTML = '';
      createParticles();
    }
  });

  // --- Mes Publications ---
  document.getElementById('showMyPostsBtn').addEventListener('click', function() {
    showMyPostsModal();
  });
  document.getElementById('closeMyPostsModal').onclick = function() {
    document.getElementById('myPostsModal').style.display = 'none';
  };
  document.getElementById('myPostsModal').onclick = function(e) {
    if (e.target === this) this.style.display = 'none';
  };

  function showMyPostsModal() {
    const listEl = document.getElementById('myPostsList');
    const myPosts = posts.filter(p => p.authorId === userData.id);
    if (myPosts.length === 0) {
      listEl.innerHTML = `<div style="color:#555; padding:18px; text-align:center;">Aucune publication trouvée.</div>`;
    } else {
      listEl.innerHTML = myPosts.map(post => {
        const timeAgo = getTimeAgo(post.timestamp);
        let img = post.imageUrl ? `<img src="${post.imageUrl}" alt="" style="max-width:80px; max-height:80px; border-radius:7px; margin-bottom:8px; display:block;">` : "";
        return `
          <div style="border-bottom:1px solid #eee; padding:10px 0 11px 0; display:flex; gap:14px; align-items:center;">
            <div style="flex:0 0 80px;">
              ${img}
            </div>
            <div style="flex:1;">
              <div style="font-weight:500; color:#222;">${post.text ? post.text : "(aucun texte)"}</div>
              <div style="font-size:13px; color:#666; margin-top:3px;">${timeAgo}</div>
            </div>
            <button onclick="deleteMyPost('${post.id}')" style="margin-left:10px; background:linear-gradient(135deg, #e85c6b, #c44569); color:#fff; border:none; border-radius:8px; padding:7px 12px; font-size:13px; cursor:pointer;">
              Supprimer
            </button>
          </div>
        `;
      }).join('');
    }
    document.getElementById('myPostsModal').style.display = 'flex';
  }

  window.deleteMyPost = function(postId) {
    if (!confirm("Voulez-vous vraiment supprimer cette publication ? Cette action est irréversible.")) return;
    const updates = {};
    updates['/posts/' + postId] = null;
    updates['/likes/' + postId] = null;
    updates['/comments/' + postId] = null;
    firebase.database().ref().update(updates)
      .then(() => {
        showMyPostsModal();
      })
      .catch(() => alert("Erreur lors de la suppression."));
  };
</script>

<!-- BARRE DE COMPRESSION -->
<style>
  #compressionProgressContainer {
    display: none;
    width: 100%;
    background: #ddd;
    height: 6px;
    border-radius: 3px;
    margin-top: 8px;
    overflow: hidden;
  }
  #compressionProgress {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #8BC34A);
    transition: width 0.2s;
  }
</style>
<div id="compressionProgressContainer">
  <div id="compressionProgress"></div>
</div>
